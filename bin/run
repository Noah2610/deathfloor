#!/bin/bash

# shellcheck source=./util.sh disable=SC2155
function _dl_util_sh {
    local UTIL_VERSION="v2.2.3"
    local dir="$( dirname "$( realpath "$1" )" )"
    [ -f "${dir}/util.sh" ] || bash "${dir}/download-util.sh" "$UTIL_VERSION" || exit 1
    source "${dir}/util.sh"
}; _dl_util_sh "$0"

[ -z "$CARGO_CMD" ] && CARGO_CMD="run"

check "cargo"

function main {
    local args
    local cmd
    args=( --features "nightly,debug" "$@" )
    cmd=( \
        cargo "$CARGO_CMD" \
        "${args[@]}" \
    )

    msg "$(clr yellow black bold)Running$(clrrs) $(clr "${CLR_CODE[@]}")${cmd[*]}$(clrrs)"
    if should_run_in_terminal; then
        run_terminal "${cmd[@]}"
    else
        "${cmd[@]}"
    fi
}

main "$@"
